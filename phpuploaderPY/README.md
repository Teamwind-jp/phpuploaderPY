# phpuploaderPY

![phpuploader](http://teamwind.serveblog.net/github/phpuploader/phpuploader.jpg)

本プロジェクトは、pythonによるサーバーサイドの保守ツールです。  
指定フォルダをzip(password付)し指定サイズで分割後、他サーバーへアップロード(php)しバックアップしています。  
  
処理内容は、  
1.指定フォルダをzip。  
2.負荷のかからないサイズの複数ファイルにカット。  
3.順次phpサーバーへアップロードしています。  
4.phpサーバー側で結合し保管。添付のphpを参照してください。(receive.php)  
5.以上を日次または即時実行。  
以上です。  
  
※※補足※※  
Windowsサーバー用に.Net版で公開中の 下記プロジェクトと同様の処理をpython版で作るとどうなるのかという目的で作成しました。よろしければこちらのリポリトジもご覧ください。  
phpuploader  basic版  
phpuploaderCS c#版  
phpuploaderNJS Node.js版  
  
# Requirement
Windows11上で書いています。  
Visual Studio 2022を使用しています。Version 17.14.13 (August 2025)    
VSにてpython環境をインストールしています。 Python 3.9(64-bit))  
  
本プロジェクトを実行するためのphpサーバーを別途用意してください。  
  
# Usage
1.本プロジェクトのソース以外に使用しているライブラリは下記です。  
　tkinterdnd2  　(D&D機能用)  
　pyzipper  　(パスワード付きzip圧縮用)  
　requests 　(ファイルアップロード用)  
　以上3つをVisualStudioのPython環境のパッケージPyPIにてインストールしています。  
2.起動後、上図サンプル画面を参考に入力欄を設定してください。startボタンで開始します。  
3.分割サイズは、php.iniの「post_max_size = 」側と合わせて調整してください。  
4.もし公開サーバーで検証する場合は、phpのファイル名を複雑怪奇にしたり認証処理も追加するなどセキュリティを強化した方がよいと思います。  
5.添付しているreceive.phpは、公開中の.net版と共通です。フォルダの指定などwindowsサーバー前提にしていますので適宜変更してください。  
  
# How It Works
    
1.メイン処理は、backgroundWorker内に書いています。  
2.メイン処理は、永久ループしています。外部からのトリガーによって処理を開始しています。  
3.トリガーは、即時実行と日次実行があります。timer内でトリガーフラグを制御しています。    
4.日次の場合は、設定した次回実行日時とシステム日を比較判定しています。  
5.phpは、受信したファイルのmd5値をprmと比較、最終ファイルなら結合をしています。  
  
# Tecnical Details
  
1.zip。  
2.ファイルio。  
3.md5取得。  
4.requestsライブラリでupload。php連携。  
5.非同期処理。  
  
※※補足※※  
pyzipperライブラリの仕様上、パスワードは、AES暗号化しています。(zipfolder.py参照)  
そのためWindowsエクスプローラーでは解凍できません。別途7zip等の専用アプリが必要です。  

# Note
  
本プロジェクトは、実際に運用している.net版を元にしています。Pythonで作るとどうなるか？という目的で作成しましたが同じ結果になりました。phpは、.net版と共通です。  
実際に運用する場合は、もう少しセキュリティとエラー対策を強化する必要があります。サーバー負荷軽減の調整も必要です。  
コードはすべてwindows前提です。他OSはパス等適宜変更してください。  
バグがあるかもしれません。自己責任でご利用ください。また適宜コード変更してください。  
ご要望等がございましたらメール下さい。  
  
# License
MIT license。著作権は、Teamwindです。  
その他ライブラリは、ライブラリ作者に帰属します。  
